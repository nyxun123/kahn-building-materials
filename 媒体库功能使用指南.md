# 媒体库功能使用指南

## 🎉 功能已部署

**最新部署**: https://e9449b3d.kahn-building-materials.pages.dev  
**生产域名**: https://kn-wallpaperglue.com

---

## 📋 快速开始

### 步骤 1: 运行数据库迁移

首先需要创建 `media_files` 数据表。

**访问以下URL**:
```
https://kn-wallpaperglue.com/api/admin/migrate-media-files
```

**预期响应**:
```json
{
  "success": true,
  "message": "media_files 表创建成功",
  "tableInfo": [...]
}
```

如果看到 `"success": true`，说明数据库迁移成功！

---

### 步骤 2: 访问媒体库管理页面

1. 登录管理后台: https://kn-wallpaperglue.com/admin/login
2. 在左侧导航栏找到 **"媒体库"** 菜单项
3. 点击进入媒体库管理页面

---

## 🎬 功能演示

### 1. 上传图片

1. 点击页面右上角的 **"上传图片"** 按钮
2. 在弹出的对话框中：
   - 拖拽图片文件到上传区域，或点击选择文件
   - 支持的格式：JPG, PNG, WebP, GIF
   - 最大文件大小：10MB
3. 等待上传完成（会显示进度条）
4. 点击 **"保存到媒体库"** 按钮

**完成！** 图片已保存到媒体库。

---

### 2. 上传视频

1. 点击页面右上角的 **"上传视频"** 按钮
2. 在弹出的对话框中：
   - 拖拽视频文件到上传区域，或点击选择文件
   - 支持的格式：MP4, MOV, AVI, WMV, WebM, MKV
   - 最大文件大小：100MB
3. 等待上传完成（会显示进度条）
4. 点击 **"保存到媒体库"** 按钮

**完成！** 视频已保存到媒体库。

---

### 3. 编辑文件元数据

1. 在媒体文件卡片上，点击 **"编辑"** 按钮
2. 在弹出的对话框中，可以编辑：
   - **多语言标题**（中文、英文、俄文）
   - **多语言描述**（中文、英文、俄文）
   - **使用位置**（选择文件将在哪里使用）
     - 首页 - 演示视频
     - 首页 - OEM定制
     - 首页 - 半成品小袋
     - OEM页面
     - 产品页面
3. 点击 **"保存更改"** 按钮

**完成！** 文件元数据已更新。

---

### 4. 筛选和搜索

**按文件类型筛选**:
- 点击 "文件类型" 下拉菜单
- 选择 "图片" 或 "视频"

**按文件夹筛选**:
- 点击 "文件夹" 下拉菜单
- 选择 "首页"、"OEM"、"产品" 或 "通用"

**搜索文件**:
- 在搜索框中输入文件名
- 实时过滤显示匹配的文件

---

### 5. 删除文件

1. 在媒体文件卡片上，点击 **"删除"** 按钮
2. 确认删除操作

**注意**: 删除是软删除，文件不会从存储中删除，只是标记为不活跃。

---

## 📊 媒体库统计

页面顶部显示以下统计信息：

- **总文件数**: 所有媒体文件的总数
- **图片数量**: 图片文件的数量
- **视频数量**: 视频文件的数量
- **搜索结果**: 当前筛选/搜索后的文件数量

---

## 🎨 在前端页面使用媒体文件

### 方法 1: 在首页内容管理中使用

1. 访问 **"首页内容"** 管理页面
2. 选择对应的板块：
   - 演示视频
   - OEM定制
   - 半成品小袋
3. 使用上传组件上传文件
4. 保存内容

### 方法 2: 直接使用媒体库中的文件

1. 在媒体库中找到需要的文件
2. 复制文件的 URL（可以在编辑对话框中看到）
3. 在其他管理页面中使用该 URL

---

## 🔧 技术细节

### 文件存储位置

所有文件存储在 Cloudflare R2 存储桶中：

```
kaen/
├── home/
│   ├── images/
│   └── videos/
├── oem/
│   ├── images/
│   └── videos/
├── products/
│   └── images/
└── general/
    ├── images/
    └── videos/
```

### 文件命名规则

上传的文件会自动重命名为：
```
{timestamp}_{random}.{extension}
```

例如：`1704528000000_abc123.mp4`

### 支持的文件格式

**图片**:
- JPEG (.jpg, .jpeg)
- PNG (.png)
- WebP (.webp)
- GIF (.gif)

**视频**:
- MP4 (.mp4) - 推荐
- MOV (.mov)
- AVI (.avi)
- WMV (.wmv)
- WebM (.webm)
- MKV (.mkv)

### 文件大小限制

- **图片**: 最大 10MB
- **视频**: 最大 100MB

---

## 🐛 常见问题

### Q1: 上传失败怎么办？

**检查以下几点**:
1. 文件大小是否超过限制
2. 文件格式是否支持
3. 网络连接是否正常
4. 浏览器控制台是否有错误信息

### Q2: 视频无法播放？

**解决方案**:
1. 确保视频格式为 MP4（最佳兼容性）
2. 检查视频文件是否损坏
3. 尝试使用其他浏览器
4. 检查 R2 公共域名配置

### Q3: 找不到上传的文件？

**检查以下几点**:
1. 确认文件已保存到媒体库（点击了"保存到媒体库"按钮）
2. 检查筛选条件（文件类型、文件夹）
3. 尝试刷新页面
4. 检查搜索框是否有输入

### Q4: 如何批量上传文件？

**当前版本不支持批量上传**，需要逐个上传文件。这是后续优化的功能之一。

---

## 📈 后续优化计划

1. **批量上传**: 支持一次选择多个文件上传
2. **图片编辑**: 裁剪、旋转、调整大小
3. **视频缩略图**: 自动生成视频封面图
4. **文件夹管理**: 创建、重命名、删除文件夹
5. **标签系统**: 为文件添加标签，方便分类
6. **使用统计**: 查看文件在哪些页面被使用
7. **批量操作**: 批量删除、批量移动文件夹

---

## 📞 需要帮助？

如果遇到问题，请提供以下信息：

1. **浏览器控制台截图**（按 F12 打开）
2. **具体的错误信息**
3. **操作步骤**（如何重现问题）
4. **文件信息**（文件名、大小、格式）

---

## ✅ 测试清单

在正式使用前，建议完成以下测试：

- [ ] 数据库迁移成功
- [ ] 能够访问媒体库页面
- [ ] 上传图片成功
- [ ] 上传视频成功
- [ ] 编辑文件元数据成功
- [ ] 删除文件成功
- [ ] 筛选功能正常
- [ ] 搜索功能正常
- [ ] 统计数据正确显示
- [ ] 在前端页面能看到上传的文件

---

## 🎊 完成！

现在你可以开始使用媒体库功能了！

**快速链接**:
- 管理后台登录: https://kn-wallpaperglue.com/admin/login
- 媒体库管理: https://kn-wallpaperglue.com/admin/media-library
- 首页内容管理: https://kn-wallpaperglue.com/admin/home-content
- 数据库迁移: https://kn-wallpaperglue.com/api/admin/migrate-media-files

祝使用愉快！ 🚀

